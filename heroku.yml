# a
# https://devcenter.heroku.com/ja/articles/build-docker-images-heroku-yml#heroku-yml
# https://devcenter.heroku.com/ja/categories/ruby-support
# https://github.com/naohito-T/Neams-api/blob/develop/heroku.yml
# setup:
#   addons:
# #     # https://bagelee.com/programming/docker-rails-deploy-heroku/
#     -plan: jawsdb:kitefin
build:
  # https://zenn.dev/daijiro/articles/deploying-with-docker-on-heroku#heroku-%E4%B8%8A%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E5%8F%82%E7%85%A7%E6%96%B9%E6%B3%95
  docker:
    web: Dockerfile.web
release:
  command:
    - mv -f config/environments/production.heroku.rb confing/environments/production.rb
    - mv -f config/database.heroku.yml config/database.yml
    - mv -f config/puma.heroku.rb config/puma.rb
    - mv -f Procfile.heroku Procfile
    # - bundle exec bundle install
    # - bundle exec rake db:create RAILS_ENV=production
    - bundle exec rake db:migrate RAILS_ENV=production
    - bundle exec rake db:seed_fu RAILS_ENV=production
    - bundle exec rails webpacker:compile
    # - bundle exec rails assets:precompile
    - bundle exec bin/webpack
run:
  web: bundle exec puma -C config/puma.rb
